def gs    // define a variable for the external groovy script (gs.groovy)

pipeline{
    agent any

    environment {
        VERSION = "2.0" 
        REPOSITRY = "https://github.com/hamdiz0/vote-app.git"
    }

    stages{
        stage("load-script"){
            steps{
                script{
                    gs = load "gs.groovy"
                }
            }
        }
        /* 
        stage("build-vote-image"){
            steps{
                script{
                    gs.build('hamdiz0/va-vote','2.0','docker-repo','./vote')    // calling the build function from the external script
                }
            }
        }
        stage("build-result-image"){
            steps{
                script{
                    gs.build('hamdiz0/va-result','2.0','docker-repo','./result')
                }
            }
        }
        stage("build-worker-image"){
            steps{
                script{
                    gs.build('hamdiz0/va-worker','2.0','docker-repo','./worker')
                }
            }
        }
        */
        stage("deploy app"){
            steps{
                script {
                    gs.deploy(
                        'vagrant',                                          // remote user name
                        '192.168.1.22',                                     // Ip address of the remote machine
                        env.VERSION ,                                       // version
                        'local-k8s',                                        // credentail Id in jenkins
                        env.REPOSITRY ,                                     // git repositry
                        'vote-app/k8s-specifications/k8s-cluster-run.sh'    // Repo_Name/Path/Deployment_Script
                    )
                }
            }
        }
    }
}
